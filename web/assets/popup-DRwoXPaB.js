import{r as e,I as a,c as o,p as t,e as n,f as l,j as r,A as s,g as c,P as i,h as d,T as f,u,i as m,t as h,k as p,l as x,m as g,F as b,n as y,o as j,q as C,v as w,w as v,x as k,U as S,B as F,y as N,z as _,C as D,D as I,E as T,G as V,H as z,J as L,K as P,L as q,N as B,O,Q as U,V as R,W as E,X as M,Y as W,Z as H,_ as G,$ as A,a0 as K,a1 as X,a2 as Y,a3 as $,a4 as J,d as Q,s as Z,R as ee,b as ae}from"./main-KjJepRzY.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M412.7 696.5l246-178c4.4-3.2 4.4-9.7 0-12.9l-246-178c-5.3-3.8-12.7 0-12.7 6.5V381c0 10.2 4.9 19.9 13.2 25.9L558.6 512 413.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"right-square",theme:"outlined"};function te(){return te=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},te.apply(this,arguments)}const ne=(o,t)=>e.createElement(a,te({},o,{ref:t,icon:oe})),le=e.forwardRef(ne);function re(){const a=o.c(4);let l,u,m,h;return a[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],a[0]=l):l=a[0],e.useEffect(se,l),a[1]===Symbol.for("react.memo_cache_sentinel")?(u=t(n),a[1]=u):u=a[1],a[2]===Symbol.for("react.memo_cache_sentinel")?(m=r.jsx(s,{notification:{stack:{threshold:1}},children:r.jsx(c,{})}),a[2]=m):m=a[2],a[3]===Symbol.for("react.memo_cache_sentinel")?(h=r.jsx(i,{store:n,children:r.jsxs(d,{loading:null,persistor:u,children:[m,r.jsx(f,{children:r.jsx(ie,{})})]})}),a[3]=h):h=a[3],h}function se(){return ce}function ce(){l()}const ie=()=>{const a=o.c(51),t=u(),[l]=m(),[s,c]=e.useState(),{token:i}=h.useToken(),d=p(de),f=p(fe),[Q,Z]=e.useState(!1),ee="1"===localStorage.getItem("initOver"),ae=p(ue),oe=p(me),te=p(he),ne=p(pe),re=p(xe),se=p(ge),ce=p(be),ie=p(ye);let Fe;a[0]===Symbol.for("react.memo_cache_sentinel")?(Fe=[],a[0]=Fe):Fe=a[0];const[Ne,_e]=e.useState(Fe),[De,Ie]=e.useState(!1);let Te;a[1]!==f?(Te=f?.map(je),a[1]=f,a[2]=Te):Te=a[2];const Ve=Te;let ze,Le,Pe,qe,Be,Oe;if(a[3]!==ce||a[4]!==ie||a[5]!==l||a[6]!==s){let Ae=function(e,a){D(0,_e),H({url:T.getWebsiteInfo2,data:{url:e}}).then(e=>{200===e?.code&&e.data&&(l.setFieldValue("icon",e.data.icon||""),l.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout(()=>{c({...s,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ce||"#ffffff",fontColor:e.data.fontColor||ie||"#000000"}),z(0,_e)},0))}).catch(()=>{a?Xe(a):Ke(e)})},Ke=function(e){D(0,_e),I({url:T.getWebsiteInfo,data:{url:e}}).then(e=>{200===e?.code&&e.data&&(l.setFieldValue("icon",e.data.icon||""),l.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout(()=>{c({...s,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||ce||"#ffffff",fontColor:e.data.fontColor||ie||"#000000"})},0))}).finally(()=>{z(0,_e)})};async function Xe(e){D(0,_e);const a=n.getState().home.getWebsiteInfoBy;if(X()&&"local"===a){const a=await Y({todo:"uploadIcon",icon:e});if(!a||$(a)&&J(a))_.error("网站图标获取失败");else if(200===a.code&&a.data){const e=a.data.faviconUrl;l.setFieldValue("icon",e),Ie(!1),c({...s,icon:e,backgroundColor:ce||"#ffffff",fontColor:ie||"#000000"})}z(0,_e)}else H({url:T.uploadFavicon,data:{faviconUrl:e}}).then(e=>{200===e?.code&&e.data&&(l.setFieldValue("icon",e.data.faviconUrl),Ie(!1),c({...s,icon:e.data.faviconUrl,backgroundColor:ce||"#ffffff",fontColor:ie||"#000000"}))}).catch(Ce).finally(()=>{z(0,_e)})}ze=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},function(e){if(0!==e.length){const a=e[0];if(!a.url)return void Z(!0);Z(!1),Ae(a.url,a.favIconUrl),l.setFieldsValue({label:a.title,link:a.url}),c({...s,backgroundColor:ce||"#ffffff",fontColor:ie||"#000000",label:a.title,link:a.url})}}):Z(!0)},a[3]=ce,a[4]=ie,a[5]=l,a[6]=s,a[7]=ze}else ze=a[7];a[8]!==ze?(Le=()=>{ee&&ze()},a[8]=ze,a[9]=Le):Le=a[9],a[10]===Symbol.for("react.memo_cache_sentinel")?(Pe=[],a[10]=Pe):Pe=a[10],e.useLayoutEffect(Le,Pe),a[11]!==t?(qe=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const a=(e,a)=>"updateListDataFromNewtab"===e.action?(t(W(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(t(E(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(a),()=>{chrome.runtime.onMessage.removeListener(a)}},a[11]=t,a[12]=qe):qe=a[12],a[13]===Symbol.for("react.memo_cache_sentinel")?(Be=[],a[13]=Be):Be=a[13],e.useEffect(qe,Be),a[14]!==t||a[15]!==re||a[16]!==se||a[17]!==ae||a[18]!==De||a[19]!==f||a[20]!==te||a[21]!==s||a[22]!==oe||a[23]!==d?(Oe=function(e){const a=e.categoryId,o=n.getState().card.defaultCardSize,l=n.getState().card.defaultCardShowType,r=n.getState().card.defaultIconPadding;if(!oe&&te){delete e.categoryId;const a={...s,...e,id:U(),size:o||"11",type:"link",showType:s.icon?l||"icon":"text",x:re,y:se,iconPadding:r||De?0:6},n=R(ae).concat([a]);t(E(n)),_.success("卡片已添加至全屏自由拖拽"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:n},we)}catch(e){}},0)}else{const n={...s,...e,id:U(),size:o||"11",type:"link",showType:s.icon?l||"icon":"text",iconPadding:r||De?0:6},c=M(R(f),a,n);t(W(c)),_.success("卡片添加完成"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:c},ve)}catch(e){}},0)}d&&H({url:T.pushData,data:{data:G(),timestamp:Date.now()},token:d}),D(2,_e)},a[14]=t,a[15]=re,a[16]=se,a[17]=ae,a[18]=De,a[19]=f,a[20]=te,a[21]=s,a[22]=oe,a[23]=d,a[24]=Oe):Oe=a[24];const Ue=Oe;let Re,Ee,Me,We,He,Ge;return a[25]!==i.colorBgContainer?(Re={background:i.colorBgContainer},a[25]=i.colorBgContainer,a[26]=Re):Re=a[26],a[27]===Symbol.for("react.memo_cache_sentinel")?(Ee=r.jsx("img",{src:A,className:"w-[24px] h-[24px]"}),a[27]=Ee):Ee=a[27],a[28]===Symbol.for("react.memo_cache_sentinel")?(We=r.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[Ee,r.jsx(F,{type:"link",className:"p-0",icon:r.jsx(le,{}),onClick:ke,children:"打开主页"})]}),Me=r.jsx(K,{type:"horizontal",className:"m-0"}),a[28]=Me,a[29]=We):(Me=a[28],We=a[29]),a[30]!==ne||a[31]!==ce||a[32]!==ie||a[33]!==Ve||a[34]!==l||a[35]!==ze||a[36]!==De||a[37]!==Q||a[38]!==f||a[39]!==Ne||a[40]!==Ue||a[41]!==te||a[42]!==s||a[43]!==oe||a[44]!==i.colorFillSecondary||a[45]!==i.colorTextDescription||a[46]!==d?(He=r.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:ee?Q?r.jsx(x,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):Ne[2]?r.jsx(x,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):r.jsxs(b,{labelCol:{flex:"82px"},form:l,initialValues:{categoryId:f[ne]?.id},layout:"horizontal",onFinish:Ue,onValuesChange:()=>{const e=l.getFieldsValue();c({...s,backgroundColor:ce||"#ffffff",fontColor:ie||"#000000",...e})},children:[r.jsx("div",{style:{backgroundColor:`${i.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:s?.label||s?.icon?r.jsx("div",{style:{backgroundColor:s?.backgroundColor||ce||"#ffffff",borderRadius:"12px",padding:De?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:Ne[0]||Ne[1]?r.jsx(y,{spinning:!0}):s.icon?s.icon?.startsWith("/default/")?r.jsx(j,{style:{fontSize:40,color:s.fontColor||"#000000"}}):r.jsx("img",{src:C(s.icon),alt:"",className:"w-full h-full",onError:Se}):r.jsx("p",{style:{fontSize:w(s.label)>2?"14px":"18px"},className:"line-clamp-2 font-bold text-center w-full pt-[2px] break-words whitespace-break-spaces",children:s.label})}):r.jsx("p",{style:{color:i.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),r.jsx(b.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:r.jsx(v,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),r.jsx(b.Item,{name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:r.jsx(k,{placeholder:"卡片名称",allowClear:!0,maxLength:100,autoSize:{minRows:1,maxRows:1}})}),r.jsx(b.Item,{required:!0,name:"icon",rules:[{validator:(e,a)=>a&&""!==a&&a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve()}],children:r.jsx(v,{addonBefore:r.jsx(L,{title:"设为本地默认",destroyOnHidden:!0,children:r.jsx(F,{type:"text",className:"rounded-none",icon:r.jsx(P,{}),onClick:()=>{l.setFieldValue("icon","/default/IeOutlined"),l.validateFields({dirty:!0}),c({...s,icon:"/default/IeOutlined",backgroundColor:ce||"#ffffff",fontColor:ie||"#000000"})}})}),addonAfter:r.jsx(S,{disabled:!d,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(_.error("图标大小不能超过200KB！"),!1):(D(1,_e),I({url:T.uploadIcon,token:d,data:V({file:e})}).then(e=>{200===e?.code&&e.data&&(l.setFieldValue("icon",e.data.icon_url),l.validateFields({dirty:!0}),c({...s,icon:e.data.icon_url,backgroundColor:ce||"#ffffff",fontColor:ie||"#000000"}))}).finally(()=>{z(1,_e)}),!1),children:r.jsx(F,{onClick:()=>{d||_.error("请您先完成登录/注册")},loading:Ne[0],type:"text",className:"rounded-none",children:"上传",icon:r.jsx(N,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),r.jsx(b.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:r.jsx(q,{disabled:!oe&&te,options:Ve,allowClear:!0,placeholder:"目标分组"})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(F,{className:"w-full",disabled:Ne[0]||Ne[1]||Ne[2],onClick:()=>{ze()},children:"重新获取信息"}),r.jsx(F,{className:"w-full",type:"primary",htmlType:"submit",loading:Ne[0]||Ne[1],disabled:Ne[2],children:Ne[0]?"正在获取图标":Ne[1]?"正在上传图标":"保存卡片信息"})]}),r.jsx(B,{className:"w-full mt-3",icon:r.jsx(O,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):r.jsx(x,{icon:r.jsx(g,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),a[30]=ne,a[31]=ce,a[32]=ie,a[33]=Ve,a[34]=l,a[35]=ze,a[36]=De,a[37]=Q,a[38]=f,a[39]=Ne,a[40]=Ue,a[41]=te,a[42]=s,a[43]=oe,a[44]=i.colorFillSecondary,a[45]=i.colorTextDescription,a[46]=d,a[47]=He):He=a[47],a[48]!==He||a[49]!==Re?(Ge=r.jsxs("div",{className:"w-[360px] h-[488px]",style:Re,children:[We,Me,He]}),a[48]=He,a[49]=Re,a[50]=Ge):Ge=a[50],Ge};function de(e){return e.user.token}function fe(e){return e.appData.listData}function ue(e){return e.appData.freeDragListData}function me(e){return e.swiper.showSwiper}function he(e){return e.home.showFreeDrag}function pe(e){return e.swiper.activeIndex}function xe(e){return e.home.freeDragGridX}function ge(e){return e.home.freeDragGridY}function be(e){return e.card.addCardDefaultBgColor}function ye(e){return e.card.addCardDefaultFontColor}function je(e){return{label:e.label,value:e.id}}function Ce(){_.error("网站图标保存失败")}function we(e){}function ve(e){}function ke(){window.open(window.location.origin+"/newtab.html","_blank")}function Se(e){e.currentTarget.src="/icons/default_image.svg"}Q.locale("zh-cn"),Z(!1),ee.createRoot(document.body).render(window.location.protocol.includes("http")?r.jsx(ae,{}):r.jsx(re,{}));
