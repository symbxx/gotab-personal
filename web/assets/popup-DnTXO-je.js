import{g as e,r as a,I as o,c as t,p as n,e as r,f as l,j as s,A as c,h as i,P as d,i as f,T as u,u as m,k as h,t as p,l as x,m as g,n as b,F as y,o as j,q as C,v as w,w as v,x as k,y as S,U as F,B as _,z as N,C as D,D as I,E as T,G as V,H as z,J as L,K as P,L as O,N as q,O as B,Q as U,V as M,W as R,X as E,Y as W,Z as H,_ as G,$ as A,a0 as K,a1 as X,a2 as Y,a3 as $,a4 as J,a5 as Q,d as Z,s as ee,R as ae,b as oe}from"./main-rLKgjl6z.js";var te,ne={};function re(){if(te)return ne;te=1,Object.defineProperty(ne,"__esModule",{value:!0});return ne.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M412.7 696.5l246-178c4.4-3.2 4.4-9.7 0-12.9l-246-178c-5.3-3.8-12.7 0-12.7 6.5V381c0 10.2 4.9 19.9 13.2 25.9L558.6 512 413.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"right-square",theme:"outlined"},ne}const le=e(re());function se(){return se=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},se.apply(this,arguments)}const ce=(e,t)=>a.createElement(o,se({},e,{ref:t,icon:le})),ie=a.forwardRef(ce);function de(){const e=t.c(4);let o,l,m,h;return e[0]===Symbol.for("react.memo_cache_sentinel")?(o=[],e[0]=o):o=e[0],a.useEffect(fe,o),e[1]===Symbol.for("react.memo_cache_sentinel")?(l=n(r),e[1]=l):l=e[1],e[2]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx(c,{notification:{stack:{threshold:1}},children:s.jsx(i,{})}),e[2]=m):m=e[2],e[3]===Symbol.for("react.memo_cache_sentinel")?(h=s.jsx(d,{store:r,children:s.jsxs(f,{loading:null,persistor:l,children:[m,s.jsx(u,{children:s.jsx(me,{})})]})}),e[3]=h):h=e[3],h}function fe(){return ue}function ue(){l()}const me=()=>{const e=t.c(51),o=m(),[n]=h(),[l,c]=a.useState(),{token:i}=p.useToken(),d=x(he),f=x(pe),[u,Z]=a.useState(!1),ee="1"===localStorage.getItem("initOver"),ae=x(xe),oe=x(ge),te=x(be),ne=x(ye),re=x(je),le=x(Ce),se=x(we),ce=x(ve);let de;e[0]===Symbol.for("react.memo_cache_sentinel")?(de=[],e[0]=de):de=e[0];const[fe,ue]=a.useState(de),[me,Ie]=a.useState(!1);let Te;e[1]!==f?(Te=f?.map(ke),e[1]=f,e[2]=Te):Te=e[2];const Ve=Te;let ze,Le,Pe,Oe,qe,Be;if(e[3]!==se||e[4]!==ce||e[5]!==n||e[6]!==l){let Ae=function(e,a){I(0,ue),G({url:V.getWebsiteInfo2,data:{url:e}}).then(e=>{200===e?.code&&e.data&&(n.setFieldValue("icon",e.data.icon||""),n.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout(()=>{c({...l,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||se||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"}),L(0,ue)},0))}).catch(()=>{a?Xe(a):Ke(e)})},Ke=function(e){I(0,ue),T({url:V.getWebsiteInfo,data:{url:e}}).then(e=>{200===e?.code&&e.data&&(n.setFieldValue("icon",e.data.icon||""),n.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout(()=>{c({...l,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||se||"#ffffff",fontColor:e.data.fontColor||ce||"#000000"})},0))}).finally(()=>{L(0,ue)})};async function Xe(e){I(0,ue);const a=r.getState().home.getWebsiteInfoBy;if(Y()&&"local"===a){const a=await $({todo:"uploadIcon",icon:e});if(!a||J(a)&&Q(a))D.error("网站图标获取失败");else if(200===a.code&&a.data){const e=a.data.faviconUrl;n.setFieldValue("icon",e),Ie(!1),c({...l,icon:e,backgroundColor:se||"#ffffff",fontColor:ce||"#000000"})}L(0,ue)}else G({url:V.uploadFavicon,data:{faviconUrl:e}}).then(e=>{200===e?.code&&e.data&&(n.setFieldValue("icon",e.data.faviconUrl),Ie(!1),c({...l,icon:e.data.faviconUrl,backgroundColor:se||"#ffffff",fontColor:ce||"#000000"}))}).catch(Se).finally(()=>{L(0,ue)})}ze=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},function(e){if(0!==e.length){const a=e[0];if(!a.url)return void Z(!0);Z(!1),Ae(a.url,a.favIconUrl),n.setFieldsValue({label:a.title,link:a.url}),c({...l,backgroundColor:se||"#ffffff",fontColor:ce||"#000000",label:a.title,link:a.url})}}):Z(!0)},e[3]=se,e[4]=ce,e[5]=n,e[6]=l,e[7]=ze}else ze=e[7];e[8]!==ze?(Le=()=>{ee&&ze()},e[8]=ze,e[9]=Le):Le=e[9],e[10]===Symbol.for("react.memo_cache_sentinel")?(Pe=[],e[10]=Pe):Pe=e[10],a.useLayoutEffect(Le,Pe),e[11]!==o?(Oe=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const a=(e,a)=>"updateListDataFromNewtab"===e.action?(o(H(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(o(E(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(a),()=>{chrome.runtime.onMessage.removeListener(a)}},e[11]=o,e[12]=Oe):Oe=e[12],e[13]===Symbol.for("react.memo_cache_sentinel")?(qe=[],e[13]=qe):qe=e[13],a.useEffect(Oe,qe),e[14]!==o||e[15]!==re||e[16]!==le||e[17]!==ae||e[18]!==me||e[19]!==f||e[20]!==te||e[21]!==l||e[22]!==oe||e[23]!==d?(Be=function(e){const a=e.categoryId,t=r.getState().card.defaultCardSize,n=r.getState().card.defaultCardShowType,s=r.getState().card.defaultIconPadding;if(!oe&&te){delete e.categoryId;const a={...l,...e,id:M(),size:t||"11",type:"link",showType:l.icon?n||"icon":"text",x:re,y:le,iconPadding:s||me?0:6},r=R(ae).concat([a]);o(E(r)),D.success("卡片已添加至全屏自由拖拽"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:r},Fe)}catch(e){}},0)}else{const r={...l,...e,id:M(),size:t||"11",type:"link",showType:l.icon?n||"icon":"text",iconPadding:s||me?0:6},c=W(R(f),a,r);o(H(c)),D.success("卡片添加完成"),setTimeout(()=>{try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:c},_e)}catch(e){}},0)}d&&G({url:V.pushData,data:{data:A(),timestamp:Date.now()},token:d}),I(2,ue)},e[14]=o,e[15]=re,e[16]=le,e[17]=ae,e[18]=me,e[19]=f,e[20]=te,e[21]=l,e[22]=oe,e[23]=d,e[24]=Be):Be=e[24];const Ue=Be;let Me,Re,Ee,We,He,Ge;return e[25]!==i.colorBgContainer?(Me={background:i.colorBgContainer},e[25]=i.colorBgContainer,e[26]=Me):Me=e[26],e[27]===Symbol.for("react.memo_cache_sentinel")?(Re=s.jsx("img",{src:K,className:"w-[24px] h-[24px]"}),e[27]=Re):Re=e[27],e[28]===Symbol.for("react.memo_cache_sentinel")?(We=s.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[Re,s.jsx(_,{type:"link",className:"p-0",icon:s.jsx(ie,{}),onClick:Ne,children:"打开主页"})]}),Ee=s.jsx(X,{type:"horizontal",className:"m-0"}),e[28]=Ee,e[29]=We):(Ee=e[28],We=e[29]),e[30]!==ne||e[31]!==se||e[32]!==ce||e[33]!==Ve||e[34]!==n||e[35]!==ze||e[36]!==me||e[37]!==u||e[38]!==f||e[39]!==fe||e[40]!==Ue||e[41]!==te||e[42]!==l||e[43]!==oe||e[44]!==i.colorFillSecondary||e[45]!==i.colorTextDescription||e[46]!==d?(He=s.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:ee?u?s.jsx(g,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):fe[2]?s.jsx(g,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):s.jsxs(y,{labelCol:{flex:"82px"},form:n,initialValues:{categoryId:f[ne]?.id},layout:"horizontal",onFinish:Ue,onValuesChange:()=>{const e=n.getFieldsValue();c({...l,backgroundColor:se||"#ffffff",fontColor:ce||"#000000",...e})},children:[s.jsx("div",{style:{backgroundColor:`${i.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:l?.label||l?.icon?s.jsx("div",{style:{backgroundColor:l?.backgroundColor||se||"#ffffff",borderRadius:"12px",padding:me?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:fe[0]||fe[1]?s.jsx(j,{spinning:!0}):l.icon?l.icon?.startsWith("/default/")?s.jsx(C,{style:{fontSize:40,color:l.fontColor||"#000000"}}):s.jsx("img",{src:w(l.icon),alt:"",className:"w-full h-full",onError:De}):s.jsx("p",{style:{fontSize:v(l.label)>2?"14px":"18px"},className:"line-clamp-2 font-bold text-center w-full pt-[2px] break-words whitespace-break-spaces",children:l.label})}):s.jsx("p",{style:{color:i.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),s.jsx(y.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:s.jsx(k,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),s.jsx(y.Item,{name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:s.jsx(S,{placeholder:"卡片名称",allowClear:!0,maxLength:100,autoSize:{minRows:1,maxRows:1}})}),s.jsx(y.Item,{required:!0,name:"icon",rules:[{validator:(e,a)=>a&&""!==a&&a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve()}],children:s.jsx(k,{addonBefore:s.jsx(P,{title:"设为本地默认",destroyOnHidden:!0,children:s.jsx(_,{type:"text",className:"rounded-none",icon:s.jsx(O,{}),onClick:()=>{n.setFieldValue("icon","/default/IeOutlined"),n.validateFields({dirty:!0}),c({...l,icon:"/default/IeOutlined",backgroundColor:se||"#ffffff",fontColor:ce||"#000000"})}})}),addonAfter:s.jsx(F,{disabled:!d,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(D.error("图标大小不能超过200KB！"),!1):(I(1,ue),T({url:V.uploadIcon,token:d,data:z({file:e})}).then(e=>{200===e?.code&&e.data&&(n.setFieldValue("icon",e.data.icon_url),n.validateFields({dirty:!0}),c({...l,icon:e.data.icon_url,backgroundColor:se||"#ffffff",fontColor:ce||"#000000"}))}).finally(()=>{L(1,ue)}),!1),children:s.jsx(_,{onClick:()=>{d||D.error("请您先完成登录/注册")},loading:fe[0],type:"text",className:"rounded-none",children:"上传",icon:s.jsx(N,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),s.jsx(y.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:s.jsx(q,{disabled:!oe&&te,options:Ve,allowClear:!0,placeholder:"目标分组"})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(_,{className:"w-full",disabled:fe[0]||fe[1]||fe[2],onClick:()=>{ze()},children:"重新获取信息"}),s.jsx(_,{className:"w-full",type:"primary",htmlType:"submit",loading:fe[0]||fe[1],disabled:fe[2],children:fe[0]?"正在获取图标":fe[1]?"正在上传图标":"保存卡片信息"})]}),s.jsx(B,{className:"w-full mt-3",icon:s.jsx(U,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):s.jsx(g,{icon:s.jsx(b,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),e[30]=ne,e[31]=se,e[32]=ce,e[33]=Ve,e[34]=n,e[35]=ze,e[36]=me,e[37]=u,e[38]=f,e[39]=fe,e[40]=Ue,e[41]=te,e[42]=l,e[43]=oe,e[44]=i.colorFillSecondary,e[45]=i.colorTextDescription,e[46]=d,e[47]=He):He=e[47],e[48]!==He||e[49]!==Me?(Ge=s.jsxs("div",{className:"w-[360px] h-[488px]",style:Me,children:[We,Ee,He]}),e[48]=He,e[49]=Me,e[50]=Ge):Ge=e[50],Ge};function he(e){return e.user.token}function pe(e){return e.appData.listData}function xe(e){return e.appData.freeDragListData}function ge(e){return e.swiper.showSwiper}function be(e){return e.home.showFreeDrag}function ye(e){return e.swiper.activeIndex}function je(e){return e.home.freeDragGridX}function Ce(e){return e.home.freeDragGridY}function we(e){return e.card.addCardDefaultBgColor}function ve(e){return e.card.addCardDefaultFontColor}function ke(e){return{label:e.label,value:e.id}}function Se(){D.error("网站图标保存失败")}function Fe(e){}function _e(e){}function Ne(){window.open(window.location.origin+"/newtab.html","_blank")}function De(e){e.currentTarget.src="/icons/default_image.svg"}Z.locale("zh-cn"),ee(!1),ae.createRoot(document.body).render(window.location.protocol.includes("http")?s.jsx(oe,{}):s.jsx(de,{}));
