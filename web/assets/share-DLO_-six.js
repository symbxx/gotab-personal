const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shareSay-BMtpCo8p.js","assets/main-BrrS_iHi.js","assets/main-BWWoXjjw.css"])))=>i.map(i=>d[i]);
import{r as e,c as t,k as a,l as s,j as l,F as n,x as i,N as r,E as o,ar as c,as as d,B as h,G as m,H as u,C as x,D as p,J as f,ao as j,al as y,t as g,ai as _,e5 as S,Q as b,e$ as k,d as C,K as v,O as w,f0 as I,f1 as D,aw as N,ah as A,f2 as E,f3 as F,aF as H,bJ as Y,cb as L,n as P,f4 as T,ad as M,m as U,ae as V,f5 as $,aj as z,ab as O}from"./main-BrrS_iHi.js";import{N as B}from"./noPermissions-CyQ5obYw.js";import{E as J}from"./index-B1fmKG7M.js";function Z(){c.hide(d)}function q(e){return{label:e.label,value:e.id}}function G(e){return e.user.token}function K(e){return e.appData.listData}const Q=e.memo(function(u){const x=t.c(38),[p]=a(),{type:f,initialValues:j,setShareSettingData:y,setHasShare:g}=u,_=s(K),S=s(G),[b,k]=e.useState(!1);let C;x[0]!==y||x[1]!==S?(C=function(e){k(!0),e.privateCategoryIds&&(e.privateCategoryIds=e.privateCategoryIds.join(",")),o({url:m.editShareSetting,data:e,token:S}).then(e=>{200===e?.code&&e?.data&&(y&&y(e.data),c.hide(d))}).finally(()=>{k(!1)})},x[0]=y,x[1]=S,x[2]=C):C=x[2];const v=C;let w;x[3]!==g||x[4]!==y||x[5]!==S?(w=function(e){k(!0),e.privateCategoryIds&&(e.privateCategoryIds=e.privateCategoryIds.join(",")),o({url:m.addShareSetting,data:e,token:S}).then(e=>{200===e?.code&&e?.data&&(y&&y(e.data),g&&g(!0),c.hide(d))}).finally(()=>{k(!1)})},x[3]=g,x[4]=y,x[5]=S,x[6]=w):w=x[6];const I=w;let D;x[7]!==p||x[8]!==j||x[9]!==_?(D=function(){if(!j||!j.privateCategoryIds)return;const e=[];j.privateCategoryIds.forEach(t=>{const a=_?.find(e=>e.id===t);a&&e.push(a.id)}),p.setFieldValue("privateCategoryIds",e)},x[7]=p,x[8]=j,x[9]=_,x[10]=D):D=x[10];const N=D;let A,E,F,H,Y,L,P,T,M,U,V,$;x[11]!==N?(A=()=>{N()},x[11]=N,x[12]=A):A=x[12],x[13]===Symbol.for("react.memo_cache_sentinel")?(E=[],x[13]=E):E=x[13],e.useEffect(A,E),x[14]===Symbol.for("react.memo_cache_sentinel")?(F={flex:"72px"},x[14]=F):F=x[14],x[15]!==I||x[16]!==v||x[17]!==f?(H=e=>{"edit"===f?v(e):I(e)},x[15]=I,x[16]=v,x[17]=f,x[18]=H):H=x[18],x[19]===Symbol.for("react.memo_cache_sentinel")?(Y=[{validator:(e,t)=>t&&""!==t?t&&!/^[a-zA-Z0-9]+$/.test(t)?Promise.reject("分享码仅限数字和英文"):Promise.resolve():Promise.reject("请输入分享码")}],x[19]=Y):Y=x[19],x[20]===Symbol.for("react.memo_cache_sentinel")?(L=l.jsx(n.Item,{label:"分享码",required:!0,rules:Y,name:"path",children:l.jsx(i,{placeholder:"分享码",allowClear:!0,maxLength:50})}),x[20]=L):L=x[20],x[21]===Symbol.for("react.memo_cache_sentinel")?(P=l.jsx(n.Item,{name:"title",label:"标题名称",children:l.jsx(i,{placeholder:"分享页标题",allowClear:!0,maxLength:50})}),x[21]=P):P=x[21],x[22]===Symbol.for("react.memo_cache_sentinel")?(T=l.jsx(n.Item,{name:"description",label:"描述简介",children:l.jsx(i,{placeholder:"分享页描述",allowClear:!0,maxLength:200})}),x[22]=T):T=x[22],x[23]===Symbol.for("react.memo_cache_sentinel")?(M=l.jsx(n.Item,{name:"keywords",label:"关键词",children:l.jsx(i,{placeholder:"分享页关键词，SEO 使用",allowClear:!0,maxLength:200})}),x[23]=M):M=x[23],x[24]!==_?(U=_?.map(q),x[24]=_,x[25]=U):U=x[25],x[26]!==U?(V=l.jsx(n.Item,{name:"privateCategoryIds",label:"私有分类",children:l.jsx(r,{mode:"multiple",placeholder:"私有分类，分享时隐藏",options:U,allowClear:!0})}),x[26]=U,x[27]=V):V=x[27],x[28]===Symbol.for("react.memo_cache_sentinel")?($=l.jsx(h,{onClick:Z,children:"取消"}),x[28]=$):$=x[28];const z="edit"===f?"保存":"创建";let O,B;return x[29]!==b||x[30]!==z?(O=l.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[$,l.jsx(h,{loading:b,htmlType:"submit",type:"primary",children:z})]}),x[29]=b,x[30]=z,x[31]=O):O=x[31],x[32]!==p||x[33]!==j||x[34]!==V||x[35]!==O||x[36]!==H?(B=l.jsx(l.Fragment,{children:l.jsxs(n,{form:p,initialValues:j,autoComplete:"off",labelCol:F,onFinish:H,children:[L,P,T,M,V,O]})}),x[32]=p,x[33]=j,x[34]=V,x[35]=O,x[36]=H,x[37]=B):B=x[37],B});function R(){c.hide(d)}function W(e){return l.jsx(y,{content:e,replace:!1})}function X(e){return e.user.token}const ee=e.memo(function(a){const n=t.c(34),{shareSettingData:i,setShareSettingData:r}=a,[y,g]=e.useState(i.share_say),_=s(X);let S;n[0]===Symbol.for("react.memo_cache_sentinel")?(S=[],n[0]=S):S=n[0];const[b,k]=e.useState(S);let C;n[1]!==_?(C=function(e){return new Promise(t=>{o({url:m.uploadImage,token:_,data:u({file:e})}).then(e=>{200===e?.code&&e.data&&t(e.data.image_url)})})},n[1]=_,n[2]=C):C=n[2];const v=C;let w;n[3]!==y||n[4]!==r||n[5]!==i||n[6]!==_?(w=function(){y?(p(0,k),o({url:m.editShareSay,data:{shareSay:y},token:_}).then(e=>{200===e?.code&&(r&&r({...i,share_say:y}),c.hide(d))}).finally(()=>{f(0,k)})):x.error("请输入分享有话的内容")},n[3]=y,n[4]=r,n[5]=i,n[6]=_,n[7]=w):w=n[7];const I=w;let D;n[8]!==r||n[9]!==i||n[10]!==_?(D=function(){p(1,k),o({url:m.resetShareSay,token:_}).then(e=>{200===e?.code&&r&&(r({...i,share_say:""}),g(""))}).finally(()=>{f(1,k)})},n[8]=r,n[9]=i,n[10]=_,n[11]=D):D=n[11];const N=D;let A,E,F,H,Y,L,P,T,M,U;return n[12]===Symbol.for("react.memo_cache_sentinel")?(A={height:"calc(100% - 44px)"},E=e=>{g(e.text)},n[12]=A,n[13]=E):(A=n[12],E=n[13]),n[14]!==v||n[15]!==y?(F=l.jsx(J,{className:"flex-1",style:A,onChange:E,value:y,renderHTML:W,onImageUpload:v}),n[14]=v,n[15]=y,n[16]=F):F=n[16],n[17]!==b[1]?(H=l.jsx(h,{danger:!0,loading:b[1],children:"重置"}),n[17]=b[1],n[18]=H):H=n[18],n[19]!==N||n[20]!==H?(Y=l.jsx(j,{title:"是否确认重置？",onConfirm:N,children:H}),n[19]=N,n[20]=H,n[21]=Y):Y=n[21],n[22]===Symbol.for("react.memo_cache_sentinel")?(L=l.jsx(h,{onClick:R,children:"取消"}),n[22]=L):L=n[22],n[23]!==I?(P=()=>{I()},n[23]=I,n[24]=P):P=n[24],n[25]!==b[0]||n[26]!==P?(T=l.jsx(h,{loading:b[0],type:"primary",onClick:P,children:"保存"}),n[25]=b[0],n[26]=P,n[27]=T):T=n[27],n[28]!==T||n[29]!==Y?(M=l.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[Y,L,T]}),n[28]=T,n[29]=Y,n[30]=M):M=n[30],n[31]!==M||n[32]!==F?(U=l.jsxs("div",{className:"flex flex-col gap-3 h-full",children:[F,M]}),n[31]=M,n[32]=F,n[33]=U):U=n[33],U}),te=A.lazy(()=>z(()=>import("./shareSay-BMtpCo8p.js"),__vite__mapDeps([0,1,2])));function ae(){const a=t.c(28),{token:n}=g.useToken(),i=s(ne);let r;a[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],a[0]=r):r=a[0];const[u,x]=e.useState(r),y=s(le),A=s(se);let z;a[1]===Symbol.for("react.memo_cache_sentinel")?(z={path:"",title:"",description:"",keywords:"",CreatedAt:"",status:0,share_say:"",private_category_ids:"",UpdatedAt:""},a[1]=z):z=a[1];const[J,Z]=e.useState(z),[q,G]=e.useState(!1);let K;a[2]!==i?(K=function(){i&&(p(0,x),O({url:m.getUserShare,token:i}).then(e=>{200===e?.code&&e.data?(Z(e.data),G(!0)):G(!1)}).finally(()=>{f(0,x)}))},a[2]=i,a[3]=K):K=a[3];const R=K;let W,X,ae;a[4]!==R?(W=()=>{R()},a[4]=R,a[5]=W):W=a[5],a[6]===Symbol.for("react.memo_cache_sentinel")?(X=[],a[6]=X):X=a[6],e.useLayoutEffect(W,X),a[7]!==J||a[8]!==i?(ae=function(){p(1,x),o({url:m.enableShare,token:i}).then(e=>{200===e?.code&&Z({...J,status:1})}).finally(()=>{f(1,x)})},a[7]=J,a[8]=i,a[9]=ae):ae=a[9];const ie=ae;let re;a[10]!==J||a[11]!==i?(re=function(){p(2,x),o({url:m.disableShare,token:i}).then(e=>{200===e?.code&&Z({...J,status:2})}).finally(()=>{f(2,x)})},a[10]=J,a[11]=i,a[12]=re):re=a[12];const oe=re;let ce;a[13]!==i?(ce=function(){p(3,x),o({url:m.deleteShare,token:i}).then(e=>{200===e?.code&&(Z({path:"",title:"",description:"",keywords:"",CreatedAt:"",status:0,share_say:"",private_category_ids:"",UpdatedAt:""}),G(!1))}).finally(()=>{f(3,x)})},a[13]=i,a[14]=ce):ce=a[14];const de=ce;let he;a[15]!==y?(he=function(e){if(!e)return;const t=e.split(","),a=[];return t.forEach(e=>{const t=y?.find(t=>t.id===e);t&&a.push(t.label)}),a.join("，")},a[15]=y,a[16]=he):he=a[16];const me=he;let ue;return a[17]!==A||a[18]!==de||a[19]!==oe||a[20]!==ie||a[21]!==me||a[22]!==q||a[23]!==u||a[24]!==J||a[25]!==n||a[26]!==i?(ue=i?u[0]?l.jsx(_,{}):q?l.jsxs(l.Fragment,{children:[l.jsx(S,{message:"分享有话是以弱化提醒的方式展示在分享页的右上角抽屉中，支持自主自定义markdown显示内容！考虑性能，分享数据将缓存 5 分钟",type:"info",icon:l.jsx(b,{})}),l.jsx(k,{bordered:!0,column:1,className:"w-full",styles:{label:{padding:"8px 16px"},content:{padding:"8px 16px",textAlign:"end"}},items:[{label:"分享状态",children:l.jsx(v,{title:0===J.status?"请联系管理员或耐心等待审核通过":1===J.status?"您的分享页可正常访问":2===J.status?"您的分享页已暂停分享":3===J.status?"您的分享页因违规已被禁用":"",children:l.jsx(w,{className:"m-0 cursor-pointer",icon:l.jsx(b,{}),color:0===J.status?"default":1===J.status?"green":2===J.status?"orange":"red",children:0===J.status?"待审核":1===J.status?"正常":2===J.status?"已停用":"被禁用"})})},{label:"分享路径",children:J?.path?l.jsx("div",{className:"flex justify-end",children:l.jsx(h,{onClick:()=>{window.open(I+"/s/"+J?.path)},type:"link",size:"small",className:"min-h-[22px] h-full text-wrap p-0",children:l.jsx("span",{className:"text-end",children:I+"/s/"+J?.path||"-"})})}):"-"},{label:"私有分类",children:J.private_category_ids?me(J.private_category_ids):"-"},{label:"分享页标题",children:J?.title||"-"},{label:"分享页描述",children:J?.description||"-"},{label:"页面关键词",children:J?.keywords||"-"},{label:"分享有话",children:J.share_say?l.jsx("div",{className:"flex justify-end",children:l.jsx(h,{disabled:3===J.status,onClick:()=>{c.show(N,{title:"分享有话",backgroundOpacity:A?.92:void 0,children:l.jsx(e.Suspense,{children:l.jsx(te,{content:J.share_say||""})}),placement:"right"})},type:"link",className:"p-0 h-[22px]",size:"small",icon:l.jsx(D,{}),children:"预览"})}):"-"},{label:"创建时间",children:C(J?.CreatedAt).format("YYYY-MM-DD HH:mm:ss")||"-"},{label:"更新时间",children:C(J?.UpdatedAt).format("YYYY-MM-DD HH:mm:ss")||"-"}]}),3===J.status?null:l.jsxs("div",{className:"flex flex-col mt-3 gap-3",children:[l.jsxs("div",{className:"flex gap-1 font-medium pl-2",style:{color:n.colorTextDescription},children:[l.jsx(E,{}),l.jsx("p",{children:"控制台"})]}),l.jsx(h,{onClick:()=>{const e=""+(I+"/s/"+J?.path),t=J?.title,a=J?.description;H(`我的个性分享页：${e}${t?"（"+t+"）":""}${a?"，主要内容："+a:""}`)},icon:l.jsx(F,{}),children:"复制文案"}),l.jsx(h,{icon:l.jsx(Y,{}),onClick:()=>{c.show(d,{title:"有话设置",width:"860px",height:"520px",children:l.jsx(ee,{shareSettingData:J,setShareSettingData:Z})})},children:"有话设置"}),l.jsx(h,{icon:l.jsx(L,{}),onClick:()=>{c.show(d,{title:"编辑分享信息",children:l.jsx(Q,{type:"edit",initialValues:{path:J?.path,title:J?.title,description:J?.description,keywords:J?.keywords,privateCategoryIds:J?.private_category_ids.split(",")},setShareSettingData:Z})})},children:"编辑信息"}),1===J.status?l.jsx(h,{onClick:oe,loading:u[2],icon:l.jsx(P,{}),children:"暂停分享"}):2===J.status?l.jsx(h,{onClick:ie,loading:u[1],icon:l.jsx(T,{}),children:"启用分享"}):null,l.jsx(j,{title:"是否确认删除？",onConfirm:de,children:l.jsx(h,{danger:!0,icon:l.jsx(M,{}),loading:u[3],children:"删除分享"})})]})]}):l.jsx(l.Fragment,{children:l.jsx(U,{className:"flex flex-col items-center w-full px-0",icon:l.jsx("div",{className:"h-[240px]",children:l.jsx("img",{alt:"",src:$,style:{width:"auto",height:"240px"}})}),title:l.jsx("div",{className:"flex justify-center w-full",children:l.jsx(h,{onClick:()=>{c.show(d,{title:"创建分享页",children:l.jsx(Q,{type:"add",setShareSettingData:Z,setHasShare:G})})},icon:l.jsx(V,{}),type:"primary",children:"创建分享页"})})})}):l.jsx(B,{title:"权限不足",subTitle:"请您先完成登录/注册",extra:!1}),a[17]=A,a[18]=de,a[19]=oe,a[20]=ie,a[21]=me,a[22]=q,a[23]=u,a[24]=J,a[25]=n,a[26]=i,a[27]=ue):ue=a[27],ue}function se(e){return e.card.bgBackdropFilter}function le(e){return e.appData.listData}function ne(e){return e.user.token}export{ae as default};
