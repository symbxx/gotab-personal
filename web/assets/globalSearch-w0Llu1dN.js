import{r as e,e as t,c as o,u as r,l as n,t as l,bM as a,cT as s,cU as c,j as i,x as d,ax as u,q as f,cV as m,cW as x,v as g,cX as p,cY as b,cZ as h,a2 as y,c_ as k}from"./main-rLKgjl6z.js";function w(e){const o=t.getState().card.gridColumnWidth,r=t.getState().card.gridRowHeight,n=e*(t.getState().card.radius/Math.min(r,o)),l=e/2;return Math.min(n,l)}function v(e,o){const r=t.getState().card.gridColumnWidth,n=t.getState().card.gridRowHeight;return e*(o/Math.min(n,r))}const j=e.memo(()=>{const f=o.c(28),m=r(),[x,g]=e.useState(!1),[w,v]=e.useState(!1),[j,D]=e.useState("");let N;f[0]===Symbol.for("react.memo_cache_sentinel")?(N=[],f[0]=N):N=f[0];const[E,L]=e.useState(N),[M,R]=e.useState(0),B=n(C),{token:I}=l.useToken(),A=e.useRef(null),H=e.useRef(null);let W,z,F;f[1]!==m||f[2]!==w?(W=()=>{w?(m(p(!1)),m(b(!1)),localStorage.setItem("globalSearchIsOpen","1")):(localStorage.removeItem("globalSearchIsOpen"),D(""),R(0))},z=[w,m],f[1]=m,f[2]=w,f[3]=W,f[4]=z):(W=f[3],z=f[4]),e.useEffect(W,z),f[5]===Symbol.for("react.memo_cache_sentinel")?(F=async o=>{if("string"!=typeof o)throw new Error("无效的关键词，请您提供有效的文本");if(!o)return void L([]);const r=t.getState().appData.listData,n=t.getState().appData.freeDragListData,l=[...h(r.concat(n)),...y()?await k():[]],a=new Set,s=l.filter(e=>"link"===e.type&&!a.has(e.link)&&(a.add(e.link),!0)).filter(e=>{if("link"===e.type&&e.label&&e.link){const t=e.label.trim().toLowerCase(),r=e.link.trim().toLowerCase();return t.includes(o.toLowerCase())||r.includes(o.toLowerCase())}return!1});e.startTransition(()=>{L(s.slice(0,9))})},f[5]=F):F=f[5];const P=F;let K,O,U,V;f[6]!==j?(K=()=>{""!==j.trim()?P(j.trim()):L([])},O=[j,P],f[6]=j,f[7]=K,f[8]=O):(K=f[7],O=f[8]),a(K,O),f[9]===Symbol.for("react.memo_cache_sentinel")?(U=()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),v(!0),setTimeout(()=>g(!0),10))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},V=[],f[9]=U,f[10]=V):(U=f[9],V=f[10]),e.useEffect(U,V);const $=T,q=_;let X;f[11]===Symbol.for("react.memo_cache_sentinel")?(X=(e,t,o,r)=>{const{row:n,col:l}=q(e,o),a=Math.ceil(r/o);if("up"===t){const e=(0===n?a-1:n-1)*o+l;return e>=r?l:e}if("down"===t){const e=(n+1)%a*o+l;return e>=r?l:e}return e},f[11]=X):X=f[11];const Y=X;let Z,G,J;f[12]!==E||f[13]!==M||f[14]!==x?(G=()=>{if(!x||0===E.length)return;const e=e=>{const t=H.current;if(!t)return;const o=E.length,r=$(t);let n=M;e:switch(e.key){case"ArrowUp":e.preventDefault(),n=Y(M,"up",r,o);break e;case"ArrowDown":e.preventDefault(),n=Y(M,"down",r,o);break e;case"ArrowLeft":e.preventDefault(),n=(M-1+o)%o;break e;case"ArrowRight":e.preventDefault(),n=(M+1)%o;break e;case"Enter":M>=0&&window.open(E[M].link,"_blank");break e;default:return}R(n);const l=t.children[n];l&&l.scrollIntoView({block:"nearest",behavior:"smooth"})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},Z=[x,E,M],f[12]=E,f[13]=M,f[14]=x,f[15]=Z,f[16]=G):(Z=f[15],G=f[16]),e.useEffect(G,Z),f[17]===Symbol.for("react.memo_cache_sentinel")?(J=()=>{g(!1),setTimeout(()=>v(!1),300)},f[17]=J):J=f[17];const Q=J;let ee,te;return s(A,Q),c("Escape",Q),f[18]!==B||f[19]!==E||f[20]!==M||f[21]!==w||f[22]!==x||f[23]!==j||f[24]!==I?(ee=w&&i.jsx("div",{className:`fixed inset-0 z-[10000] flex py-20 px-6 justify-center bg-black bg-opacity-45 opacity-0 transition-opacity duration-200 ${x?"opacity-100":""} ${B?"backdrop-blur-sm":""}`,children:i.jsxs("div",{ref:A,className:"flex flex-col p-6 gap-4 w-full max-w-xl transform h-fit max-h-full rounded-2xl opacity-0 transition-all duration-200 "+(x?"opacity-100":""),style:{background:I.colorBgContainer,scale:x?1:.9},children:[i.jsx(d,{size:"large",autoFocus:!0,className:"border-2",placeholder:"全局搜索链接/书签卡片（ 显示前 9 个相关结果 ）",prefix:i.jsx(u,{}),value:j,onChange:e=>{D(e.target.value),R(0)}}),i.jsx("div",{className:"h-full overflow-y-auto",children:E.length>0?i.jsx("div",{ref:H,className:"grid *:cursor-pointer *:transition-all *:duration-200 *:rounded-xl",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:"12px",gridAutoRows:"68px"},children:E.map((e,t)=>i.jsx(S,{result:e,index:t,currentIndex:M},e.id))}):i.jsx("div",{className:"p-6 pb-5 text-center",style:{color:I.colorTextDescription},children:j?"无搜索结果：请更换关键词":"请先输入您要搜索的关键词"})})]})}),f[18]=B,f[19]=E,f[20]=M,f[21]=w,f[22]=x,f[23]=j,f[24]=I,f[25]=ee):ee=f[25],f[26]!==ee?(te=i.jsx(i.Fragment,{children:ee}),f[26]=ee,f[27]=te):te=f[27],te}),S=e.memo(e=>{const t=o.c(46),{result:r,index:n,currentIndex:a}=e,{token:s}=l.useToken(),c=n===a,d=r.id,u=c?s.colorPrimary:s.colorBorder,p=c?s.colorPrimaryBgHover:void 0;let b,h,y,k;t[0]!==u||t[1]!==p?(b={minWidth:0,borderColor:u,backgroundColor:p},t[0]=u,t[1]=p,t[2]=b):b=t[2],t[3]!==c||t[4]!==s.colorBgTextHover?(h=e=>{c||(e.currentTarget.style.backgroundColor=s.colorBgTextHover)},t[3]=c,t[4]=s.colorBgTextHover,t[5]=h):h=t[5],t[6]!==c?(y=e=>{c||(e.currentTarget.style.backgroundColor="")},t[6]=c,t[7]=y):y=t[7],t[8]!==r.link?(k=()=>window.open(r.link,"_blank"),t[8]=r.link,t[9]=k):k=t[9];const j=r.backgroundColor;let S;t[10]===Symbol.for("react.memo_cache_sentinel")?(S=w(40),t[10]=S):S=t[10];const C=r.iconPadding||0;let T,_,N,E,L,M,R,B,I,A,H;return t[11]!==C?(T=v(40,C),t[11]=C,t[12]=T):T=t[12],t[13]!==r.backgroundColor||t[14]!==T?(_={backgroundColor:j,borderRadius:S,padding:T},t[13]=r.backgroundColor,t[14]=T,t[15]=_):_=t[15],t[16]!==r.fontColor||t[17]!==r.icon||t[18]!==r.innerlabel||t[19]!==r.label?(N=r.icon?r.icon.startsWith("/default/")?i.jsx(f,{style:{fontSize:24,color:r.fontColor}}):m(r.icon)?i.jsx("img",{src:g(r.icon),alt:r.label,style:{objectFit:"cover",borderRadius:w(25)},onError:D}):i.jsx(x,{icon:r.icon,className:"w-full h-full",fallback:i.jsx("img",{src:"/icons/default_image.svg",className:"w-full h-full object-contain"})}):i.jsx("span",{style:{fontSize:"10px",color:r.fontColor},className:"text-center font-medium",children:r.innerlabel||r.label}),t[16]=r.fontColor,t[17]=r.icon,t[18]=r.innerlabel,t[19]=r.label,t[20]=N):N=t[20],t[21]!==_||t[22]!==N?(E=i.jsx("div",{style:_,className:"w-10 h-10 flex items-center justify-center overflow-hidden",children:N}),t[21]=_,t[22]=N,t[23]=E):E=t[23],t[24]===Symbol.for("react.memo_cache_sentinel")?(L={width:"calc(100% - 48px)"},t[24]=L):L=t[24],t[25]!==s.colorText?(M={color:s.colorText},t[25]=s.colorText,t[26]=M):M=t[26],t[27]!==r.label||t[28]!==M?(R=i.jsx("div",{style:M,children:r.label}),t[27]=r.label,t[28]=M,t[29]=R):R=t[29],t[30]!==s.colorTextDescription?(B={color:s.colorTextDescription},t[30]=s.colorTextDescription,t[31]=B):B=t[31],t[32]!==r.link||t[33]!==B?(I=i.jsx("div",{className:"text-xs",style:B,children:r.link}),t[32]=r.link,t[33]=B,t[34]=I):I=t[34],t[35]!==R||t[36]!==I?(A=i.jsxs("div",{style:L,className:"font-medium *:truncate flex flex-col justify-evenly",children:[R,I]}),t[35]=R,t[36]=I,t[37]=A):A=t[37],t[38]!==r.id||t[39]!==E||t[40]!==A||t[41]!==b||t[42]!==h||t[43]!==y||t[44]!==k?(H=i.jsxs("div",{className:"p-3 border-2 flex gap-2 cursor-pointer transition-colors duration-200 rounded-xl",style:b,onMouseEnter:h,onMouseLeave:y,onClick:k,children:[E,A]},d),t[38]=r.id,t[39]=E,t[40]=A,t[41]=b,t[42]=h,t[43]=y,t[44]=k,t[45]=H):H=t[45],H});function C(e){return e.card.bgBackdropFilter}function T(e){const t=Array.from(e.children);if(0===t.length)return 1;let o=1;const r=t[0].offsetTop;for(let n=1;n<t.length&&t[n].offsetTop===r;n++)o++;return o}function _(e,t){return{row:Math.floor(e/t),col:e%t}}function D(e){e.target.src="/icons/bookmark.svg"}export{j as default,w as getScaleRadius,v as getTruePadding};
