import{r as e,e as t,c as o,u as r,k as n,t as a,bT as l,c$ as s,d0 as c,j as i,w as d,ax as u,o as f,d1 as m,d2 as p,q as g,d3 as x,d4 as h,d5 as b,a1 as y,d6 as w}from"./main-CpZfXOxn.js";function k(e){const o=t.getState().card.gridColumnWidth,r=t.getState().card.gridRowHeight,n=e*(t.getState().card.radius/Math.min(r,o)),a=e/2;return Math.min(n,a)}function v(e,o){const r=t.getState().card.gridColumnWidth,n=t.getState().card.gridRowHeight;return e*(o/Math.min(n,r))}const S=e.memo(()=>{const f=o.c(28),m=r(),[p,g]=e.useState(!1),[k,v]=e.useState(!1),[S,E]=e.useState("");let _;f[0]===Symbol.for("react.memo_cache_sentinel")?(_=[],f[0]=_):_=f[0];const[N,L]=e.useState(_),[M,R]=e.useState(0),B=n(C),{token:I}=a.useToken(),A=e.useRef(null),H=e.useRef(null);let W,z,F;f[1]!==m||f[2]!==k?(W=()=>{k?(m(x(!1)),m(h(!1)),localStorage.setItem("globalSearchIsOpen","1")):(localStorage.removeItem("globalSearchIsOpen"),E(""),R(0))},z=[k,m],f[1]=m,f[2]=k,f[3]=W,f[4]=z):(W=f[3],z=f[4]),e.useEffect(W,z),f[5]===Symbol.for("react.memo_cache_sentinel")?(F=async o=>{if("string"!=typeof o)throw new Error("无效的关键词，请您提供有效的文本");if(!o)return void L([]);const r=t.getState().appData.listData,n=t.getState().appData.freeDragListData,a=[...b(r.concat(n)),...y()?await w():[]],l=new Set,s=a.filter(e=>"link"===e.type&&!l.has(e.link)&&(l.add(e.link),!0)).filter(e=>{if("link"===e.type&&e.label&&e.link){const t=e.label.trim().toLowerCase(),r=e.link.trim().toLowerCase();return t.includes(o.toLowerCase())||r.includes(o.toLowerCase())}return!1});e.startTransition(()=>{L(s.slice(0,9))})},f[5]=F):F=f[5];const O=F;let P,$,K,q;f[6]!==S?(P=()=>{""!==S.trim()?O(S.trim()):L([])},$=[S,O],f[6]=S,f[7]=P,f[8]=$):(P=f[7],$=f[8]),l(P,$),f[9]===Symbol.for("react.memo_cache_sentinel")?(K=()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),v(!0),setTimeout(()=>g(!0),10))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},q=[],f[9]=K,f[10]=q):(K=f[9],q=f[10]),e.useEffect(K,q);const U=T,V=D;let G;f[11]===Symbol.for("react.memo_cache_sentinel")?(G=(e,t,o,r)=>{const{row:n,col:a}=V(e,o),l=Math.ceil(r/o);if("up"===t){const e=(0===n?l-1:n-1)*o+a;return e>=r?a:e}if("down"===t){const e=(n+1)%l*o+a;return e>=r?a:e}return e},f[11]=G):G=f[11];const J=G;let Q,X,Y;f[12]!==N||f[13]!==M||f[14]!==p?(X=()=>{if(!p||0===N.length)return;const e=e=>{const o=H.current;if(!o)return;const r=N.length,n=U(o);let a=M;e:switch(e.key){case"ArrowUp":e.preventDefault(),a=J(M,"up",n,r);break e;case"ArrowDown":e.preventDefault(),a=J(M,"down",n,r);break e;case"ArrowLeft":e.preventDefault(),a=(M-1+r)%r;break e;case"ArrowRight":e.preventDefault(),a=(M+1)%r;break e;case"Enter":if(M>=0){const e=t.getState().openType.searchEngineOpenMode;window.open(N[M].link,e)}break e;default:return}R(a);const l=o.children[a];l&&l.scrollIntoView({block:"nearest",behavior:"smooth"})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},Q=[p,N,M],f[12]=N,f[13]=M,f[14]=p,f[15]=Q,f[16]=X):(Q=f[15],X=f[16]),e.useEffect(X,Q),f[17]===Symbol.for("react.memo_cache_sentinel")?(Y=()=>{g(!1),setTimeout(()=>v(!1),300)},f[17]=Y):Y=f[17];const Z=Y;let ee,te;return s(A,Z),c("Escape",Z),f[18]!==B||f[19]!==N||f[20]!==M||f[21]!==k||f[22]!==p||f[23]!==S||f[24]!==I?(ee=k&&i.jsx("div",{className:`fixed inset-0 z-[10000] flex py-20 px-6 justify-center bg-black bg-opacity-45 opacity-0 transition-opacity duration-200 ${p?"opacity-100":""} ${B?"backdrop-blur-sm":""}`,children:i.jsxs("div",{ref:A,className:"flex flex-col p-6 gap-4 w-full max-w-xl transform h-fit max-h-full rounded-2xl opacity-0 transition-all duration-200 "+(p?"opacity-100":""),style:{background:I.colorBgContainer,scale:p?1:.9},children:[i.jsx(d,{size:"large",autoFocus:!0,className:"border-2",placeholder:"全局搜索链接/书签卡片（ 显示前 9 个相关结果 ）",prefix:i.jsx(u,{}),allowClear:!0,value:S,onChange:e=>{E(e.target.value),R(0)}}),i.jsx("div",{className:"h-full overflow-y-auto",children:N.length>0?i.jsx("div",{ref:H,className:"grid *:cursor-pointer *:transition-all *:duration-200 *:rounded-xl",style:{gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:"12px",gridAutoRows:"68px"},children:N.map((e,t)=>i.jsx(j,{result:e,index:t,currentIndex:M},e.id))}):i.jsx("div",{className:"p-6 pb-5 text-center",style:{color:I.colorTextDescription},children:S?"无搜索结果：请更换关键词":"请先输入您要搜索的关键词"})})]})}),f[18]=B,f[19]=N,f[20]=M,f[21]=k,f[22]=p,f[23]=S,f[24]=I,f[25]=ee):ee=f[25],f[26]!==ee?(te=i.jsx(i.Fragment,{children:ee}),f[26]=ee,f[27]=te):te=f[27],te}),j=e.memo(e=>{const r=o.c(46),{result:n,index:l,currentIndex:s}=e,{token:c}=a.useToken(),d=l===s,u=n.id,x=d?c.colorPrimary:c.colorBorder,h=d?c.colorPrimaryBgHover:void 0;let b,y,w,S;r[0]!==x||r[1]!==h?(b={minWidth:0,borderColor:x,backgroundColor:h},r[0]=x,r[1]=h,r[2]=b):b=r[2],r[3]!==d||r[4]!==c.colorBgTextHover?(y=e=>{d||(e.currentTarget.style.backgroundColor=c.colorBgTextHover)},r[3]=d,r[4]=c.colorBgTextHover,r[5]=y):y=r[5],r[6]!==d?(w=e=>{d||(e.currentTarget.style.backgroundColor="")},r[6]=d,r[7]=w):w=r[7],r[8]!==n.link?(S=()=>{const e=t.getState().openType.searchEngineOpenMode;window.open(n.link,e)},r[8]=n.link,r[9]=S):S=r[9];const j=n.backgroundColor;let C;r[10]===Symbol.for("react.memo_cache_sentinel")?(C=k(40),r[10]=C):C=r[10];const T=n.iconPadding||0;let D,_,N,L,M,R,B,I,A,H,W;return r[11]!==T?(D=v(40,T),r[11]=T,r[12]=D):D=r[12],r[13]!==n.backgroundColor||r[14]!==D?(_={backgroundColor:j,borderRadius:C,padding:D},r[13]=n.backgroundColor,r[14]=D,r[15]=_):_=r[15],r[16]!==n.fontColor||r[17]!==n.icon||r[18]!==n.innerlabel||r[19]!==n.label?(N=n.icon?n.icon.startsWith("/default/")?i.jsx(f,{style:{fontSize:24,color:n.fontColor}}):m(n.icon)||n.icon.startsWith("chrome-extension://")?i.jsx("img",{src:n.icon.startsWith("chrome-extension://")?n.icon:g(n.icon),alt:n.label,style:{objectFit:"cover",borderRadius:k(25)},onError:E}):i.jsx(p,{icon:n.icon,className:"w-full h-full",fallback:i.jsx("img",{src:"/icons/bookmark.svg",className:"w-full h-full object-contain"})}):i.jsx("span",{style:{fontSize:"10px",color:n.fontColor},className:"text-center font-medium",children:n.innerlabel||n.label}),r[16]=n.fontColor,r[17]=n.icon,r[18]=n.innerlabel,r[19]=n.label,r[20]=N):N=r[20],r[21]!==_||r[22]!==N?(L=i.jsx("div",{style:_,className:"w-10 h-10 flex items-center justify-center overflow-hidden",children:N}),r[21]=_,r[22]=N,r[23]=L):L=r[23],r[24]===Symbol.for("react.memo_cache_sentinel")?(M={width:"calc(100% - 48px)"},r[24]=M):M=r[24],r[25]!==c.colorText?(R={color:c.colorText},r[25]=c.colorText,r[26]=R):R=r[26],r[27]!==n.label||r[28]!==R?(B=i.jsx("div",{style:R,children:n.label}),r[27]=n.label,r[28]=R,r[29]=B):B=r[29],r[30]!==c.colorTextDescription?(I={color:c.colorTextDescription},r[30]=c.colorTextDescription,r[31]=I):I=r[31],r[32]!==n.link||r[33]!==I?(A=i.jsx("div",{className:"text-xs",style:I,children:n.link}),r[32]=n.link,r[33]=I,r[34]=A):A=r[34],r[35]!==B||r[36]!==A?(H=i.jsxs("div",{style:M,className:"font-medium *:truncate flex flex-col justify-evenly",children:[B,A]}),r[35]=B,r[36]=A,r[37]=H):H=r[37],r[38]!==n.id||r[39]!==L||r[40]!==H||r[41]!==b||r[42]!==y||r[43]!==w||r[44]!==S?(W=i.jsxs("div",{className:"p-3 border-2 flex gap-2 cursor-pointer transition-colors duration-200 rounded-xl",style:b,onMouseEnter:y,onMouseLeave:w,onClick:S,children:[L,H]},u),r[38]=n.id,r[39]=L,r[40]=H,r[41]=b,r[42]=y,r[43]=w,r[44]=S,r[45]=W):W=r[45],W});function C(e){return e.card.bgBackdropFilter}function T(e){const t=Array.from(e.children);if(0===t.length)return 1;let o=1;const r=t[0].offsetTop;for(let n=1;n<t.length&&t[n].offsetTop===r;n++)o++;return o}function D(e,t){return{row:Math.floor(e/t),col:e%t}}function E(e){e.target.src="/icons/bookmark.svg"}export{S as default,k as getScaleRadius,v as getTruePadding};
