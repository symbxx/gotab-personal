import{c as e,ap as t,j as s,r as n,B as i,ac as a,O as l,a0 as o,ar as r,as as c,E as d,N as m,aq as u,F as h,w as f,C as x,e as j,D as y,H as p,at as k,al as _,au as b,av as g,ao as S,G as w,z as N}from"./main-yBlsCRjP.js";import{E as C}from"./index-BxhStlZ-.js";import{M as v,R as I}from"./myTable-D6WWRlMD.js";import{C as T}from"./contentLayout-d9TsE5QA.js";import{R as z}from"./ReloadOutlined-Cmqy4Ri4.js";import"./transformData-kYduH2MM.js";import"./MoneyCollectOutlined-CjD9F1Vp.js";import"./AlipayOutlined-kUdHxg6R.js";import"./index-BbfAH2u7.js";function F(){const n=e.c(21),{key:m,refresh:u}=t();let h,f,x,j,y,p;n[0]===Symbol.for("react.memo_cache_sentinel")?(h={title:"创建人",key:"username",width:160,fixed:"left",render:L},f={title:"状态",key:"status",width:80,render:q},x={title:"标题",key:"title",width:200},j={title:"内容",key:"content",width:400},y={type:"time",title:"创建时间",key:"notice_time",width:200},n[0]=h,n[1]=f,n[2]=x,n[3]=j,n[4]=y):(h=n[0],f=n[1],x=n[2],j=n[3],y=n[4]),n[5]!==u?(p=[h,f,x,j,y,{title:"操作",fixed:"right",width:220,render:(e,t)=>s.jsx(O,{record:t,refresh:u})}],n[5]=u,n[6]=p):p=n[6];const k=p;let _,b,g,S,w,N,C;return n[7]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsx(z,{}),n[7]=_):_=n[7],n[8]!==u?(b=s.jsx(i,{type:"primary",icon:_,onClick:()=>{u()},children:"刷新列表"}),n[8]=u,n[9]=b):b=n[9],n[10]===Symbol.for("react.memo_cache_sentinel")?(g=s.jsx(a,{type:"warning",description:s.jsxs(s.Fragment,{children:[s.jsx(l,{className:"mr-1"}),"只会通知最新一条启用的公告！公告新增后需要二次确认是否发布，并且一天只可发布一次公告，以便保证用户体验！"]}),className:"mt-3 p-1 px-3 text-xs font-normal w-full"}),S=s.jsx(o,{className:"my-3"}),n[10]=g,n[11]=S):(g=n[10],S=n[11]),n[12]!==u?(w=s.jsx("div",{className:"mb-3",children:s.jsx(i,{type:"primary",onClick:()=>{r.show(c,{title:"新增公告",children:s.jsx(M,{refresh:u,type:"add"}),width:720})},children:"新增公告"})}),n[12]=u,n[13]=w):w=n[13],n[14]!==k||n[15]!==m?(N=s.jsx(v,{columns:k,getListUrl:d.getNoticeList,dataKey:"data.list",tableKey:m}),n[14]=k,n[15]=m,n[16]=N):N=n[16],n[17]!==w||n[18]!==N||n[19]!==b?(C=s.jsxs(T,{children:[b,g,S,w,N]}),n[17]=w,n[18]=N,n[19]=b,n[20]=C):C=n[20],C}function q(e){return s.jsx(m,{color:0===e?"blue":1===e?"green":"red",children:0===e?"待审核":1===e?"正常":"停用"})}function L(e){return s.jsx(m,{color:e?"geekblue":"red",bordered:!1,icon:s.jsx(u,{}),children:e||"已注销"})}const O=n.memo(t=>{const a=e.c(43),{record:l,refresh:o}=t;let m;a[0]===Symbol.for("react.memo_cache_sentinel")?(m=[],a[0]=m):m=a[0];const[u,h]=n.useState(m);let f;a[1]!==l.id||a[2]!==o?(f=function(){x(0,h);const e=j.getState().user.token;setTimeout(()=>{y({url:d.rejectNotice,token:e,data:{id:l.id}}).then(e=>{200===e?.code&&o()}).finally(()=>{p(0,h)})},500)},a[1]=l.id,a[2]=o,a[3]=f):f=a[3];const w=f;let N;a[4]!==l.id||a[5]!==o?(N=function(){x(0,h);const e=j.getState().user.token;setTimeout(()=>{y({url:d.confirmNotice,token:e,data:{id:l.id}}).then(e=>{200===e?.code&&o()}).finally(()=>{p(0,h)})},500)},a[4]=l.id,a[5]=o,a[6]=N):N=a[6];const C=N;let v;a[7]!==l.id||a[8]!==o?(v=function(){x(1,h);const e=j.getState().user.token;setTimeout(()=>{y({url:d.deleteNotice,token:e,data:{id:l.id}}).then(e=>{200===e?.code&&o()}).finally(()=>{p(1,h)})},500)},a[7]=l.id,a[8]=o,a[9]=v):v=a[9];const T=v;let z;a[10]!==l.content||a[11]!==l.title?(z=function(){k.open({closeIcon:s.jsx("div",{className:"my-handle-icon",children:s.jsx(b,{icon:s.jsx(g,{})})}),message:l.title,description:s.jsx(_,{content:l.content}),duration:null})},a[10]=l.content,a[11]=l.title,a[12]=z):z=a[12];const F=z;let q,L;a[13]!==F?(q=s.jsx(i,{type:"link",size:"small",onClick:F,children:"预览"}),a[13]=F,a[14]=q):q=a[14],a[15]!==l||a[16]!==o?(L=s.jsx(i,{type:"link",size:"small",onClick:()=>{r.show(c,{title:"编辑公告",children:s.jsx(M,{editItem:l,type:"edit",refresh:o}),width:720})},children:"编辑"}),a[15]=l,a[16]=o,a[17]=L):L=a[17];const O=0===l.status||2===l.status?"是否确认发布？":"是否确认停用？",R=0===l.status||2===l.status?C:w;let D,E,H,K,U,A,B,G,P;return a[18]===Symbol.for("react.memo_cache_sentinel")?(D={width:"44px"},a[18]=D):D=a[18],a[19]!==u[0]||a[20]!==l.status?(E=u[0]?s.jsx(I,{}):0===l.status||2===l.status?"发布":"停用",a[19]=u[0],a[20]=l.status,a[21]=E):E=a[21],a[22]!==u[0]||a[23]!==E?(H=s.jsx(i,{type:"link",size:"small",disabled:u[0],style:D,children:E}),a[22]=u[0],a[23]=E,a[24]=H):H=a[24],a[25]!==H||a[26]!==O||a[27]!==R?(K=s.jsx(S,{title:O,onConfirm:R,children:H}),a[25]=H,a[26]=O,a[27]=R,a[28]=K):K=a[28],a[29]===Symbol.for("react.memo_cache_sentinel")?(U={width:"44px"},a[29]=U):U=a[29],a[30]!==u[1]?(A=u[1]?s.jsx(I,{}):"删除",a[30]=u[1],a[31]=A):A=a[31],a[32]!==u[1]||a[33]!==A?(B=s.jsx(i,{danger:!0,type:"link",size:"small",disabled:u[1],style:U,children:A}),a[32]=u[1],a[33]=A,a[34]=B):B=a[34],a[35]!==T||a[36]!==B?(G=s.jsx(S,{title:"是否确认删除？",onConfirm:T,children:B}),a[35]=T,a[36]=B,a[37]=G):G=a[37],a[38]!==K||a[39]!==G||a[40]!==q||a[41]!==L?(P=s.jsxs("div",{className:"flex flex-wrap",children:[q,L,K,G]}),a[38]=K,a[39]=G,a[40]=q,a[41]=L,a[42]=P):P=a[42],P}),M=t=>{const a=e.c(23),{editItem:l,refresh:o,type:m}=t,u=void 0===m?"add":m,[x]=h.useForm(),[p,k]=n.useState(!1),[_,b]=n.useState(l?.content);let g;a[0]===Symbol.for("react.memo_cache_sentinel")?(g=function(e){const t=j.getState().user.token;return new Promise(s=>{y({url:d.uploadImage,token:t,data:w({file:e})}).then(e=>{200===e?.code&&e.data&&s(e.data.image_url)})})},a[0]=g):g=a[0];const S=g;let v;a[1]!==l?.id||a[2]!==_||a[3]!==o||a[4]!==u?(v=function(e){const t=j.getState().user.token;if(!_.trim())return void N.error("请输入公告内容");const s={title:e.title,content:_};k(!0),setTimeout(()=>{y({url:"add"===u?d.addNotice:d.editNotice,token:t,data:"add"===u?s:{id:l?.id,...s}}).then(e=>{200===e?.code&&(o(),r.hide(c))}).finally(()=>{k(!1)})},500)},a[1]=l?.id,a[2]=_,a[3]=o,a[4]=u,a[5]=v):v=a[5];const I=v;let T,z,F,q,L,O,M;a[6]===Symbol.for("react.memo_cache_sentinel")?(T={flex:"82px"},a[6]=T):T=a[6],a[7]===Symbol.for("react.memo_cache_sentinel")?(z=s.jsx(h.Item,{name:"title",label:"公告标题",required:!0,rules:[{required:!0}],children:s.jsx(f,{placeholder:"公告标题"})}),F=s.jsx(h.Item,{label:"公告内容",required:!0}),a[7]=z,a[8]=F):(z=a[7],F=a[8]),a[9]===Symbol.for("react.memo_cache_sentinel")?(q={height:"calc(300px)"},L=e=>{b(e.text)},a[9]=q,a[10]=L):(q=a[9],L=a[10]),a[11]!==_?(O=s.jsx(C,{className:"flex-1 -mt-4 mb-6",style:q,onChange:L,value:_,renderHTML:R,onImageUpload:S}),a[11]=_,a[12]=O):O=a[12],a[13]===Symbol.for("react.memo_cache_sentinel")?(M=s.jsx(i,{onClick:D,children:"取消"}),a[13]=M):M=a[13];const E="add"===u?"新增公告":"保存编辑";let H,K;return a[14]!==p||a[15]!==E?(H=s.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[M,s.jsx(i,{type:"primary",htmlType:"submit",loading:p,children:E})]}),a[14]=p,a[15]=E,a[16]=H):H=a[16],a[17]!==l||a[18]!==x||a[19]!==I||a[20]!==H||a[21]!==O?(K=s.jsx(s.Fragment,{children:s.jsxs(h,{form:x,autoComplete:"off",variant:"filled",initialValues:l,labelCol:T,onFinish:I,children:[z,F,O,H]})}),a[17]=l,a[18]=x,a[19]=I,a[20]=H,a[21]=O,a[22]=K):K=a[22],K};function R(e){return s.jsx(_,{content:e,replace:!1})}function D(){r.hide(c)}export{F as default};
