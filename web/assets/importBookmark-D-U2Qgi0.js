import{u as e,l as a,r as l,k as s,t,e as r,W as o,V as i,X as n,C as d,Y as c,Z as u,ar as x,as as m,a2 as h,a3 as f,j as p,hN as g,F as j,x as b,B as C,hO as w,hP as v,hQ as k,D as y,hR as F,a4 as I,a5 as S,J as T,E as N,d7 as P,N as V,db as L,a9 as q,U as D,z,H as B,K as U,L as W,dd as H,a1 as O,hS as R,aa as A,hT as E,G}from"./main-rLKgjl6z.js";const{useToken:K}=t,{TextArea:M}=b;function _(t){const{item:_}=t,J=e(),Q=a(e=>e.appData.listData),X=a(e=>e.swiper.showSwiper),Y=a(e=>e.home.showFreeDrag),[Z,$]=l.useState(null),[ee]=s(),{token:ae}=K(),[le,se]=l.useState(!1),[te,re]=l.useState("icon"),[oe,ie]=l.useState(_||{}),ne=a(e=>e.user.token),de=a(e=>e.swiper.activeIndex),ce=a(e=>e.card.defaultCardSize),ue=a(e=>e.card.defaultCardShowType),xe=a(e=>e.card.defaultIconPadding),me=a(e=>e.card.addCardDefaultBgColor),he=a(e=>e.card.addCardDefaultFontColor),fe=Q[de].id,pe=l.useMemo(()=>Q?.map(e=>({label:e.label,value:e.id})),[Q]),ge=l.useCallback(e=>{if(Y&&!X){const a=r.getState().appData.freeDragListData,l=o(a).concat([{id:i(),type:"link",...e}]);J(n(l)),d.success("卡片已添加至自由拖拽区域")}else{const a=r.getState().appData.listData,l=c(o(a),fe,{id:i(),type:"link",...e});J(u(l)),d.success("卡片添加完成")}x.hide(m)},[fe,Z]),je=l.useRef(null);l.useEffect(()=>()=>{je.current&&clearTimeout(je.current),je.current=null},[]);const[be,Ce]=l.useState([]);return l.useEffect(()=>()=>{h()&&f({todo:"getWebsiteInfo",url:"cancel"})},[]),p.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:p.jsxs("div",{className:"flex-auto max-w-[640px]",children:[p.jsx(g,{showItem:oe}),p.jsxs(j,{id:"add-edit-link-card",form:ee,variant:"filled",autoComplete:"off",labelCol:{flex:"84px"},initialValues:{..._,link:_.url,label:_.title,size:ce||"11",openTarget:"globalSet",showType:ue||"icon",backgroundColor:me||"#ffffff",fontColor:he||"#000000",iconPadding:xe||0},onFinish:e=>{e.icon&&(e.icon=v(e.icon,"https://")),e.link&&(e.link=v(e.link,"https://")),e.internalLink&&(e.internalLink=v(e.internalLink,"http://")),ge(e)},onValuesChange:e=>{e.showType&&re(e.showType),e.backgroundColor&&ee.setFieldValue("fontColor",E(e.backgroundColor)),je.current&&clearTimeout(je.current),je.current=setTimeout(()=>{ie(ee.getFieldsValue())},0)},children:[p.jsxs("div",{className:"flex gap-3 items-end",children:[p.jsx(j.Item,{className:"flex-1",label:"卡片链接",name:"link",required:!0,rules:[{required:!0,message:"请输入卡片链接"}],children:p.jsx(b,{maxLength:512,placeholder:"请输入卡片链接，默认安全链接（https://）",allowClear:!0,addonAfter:p.jsx(C,{onClick:async()=>{const e=ee.getFieldValue("link");if(!e)return void d.error("请输入卡片链接");const a=v(e,"https://");if(!k(a))return void d.error("请输入正确的卡片链接");const l=r.getState().home.getWebsiteInfoBy;if(h()&&"local"===l){y(1,Ce);const e=await f({todo:"getWebsiteInfo",url:a}),l=(new DOMParser).parseFromString(e,"text/html"),s=F(l,a);if(I(e)&&S(e)||""===s.title)return d.error("获取网站信息失败"),void T(1,Ce);let t="",r=!1;if(s.icon){const e=await f({todo:"uploadIcon",icon:s.icon});!e||I(e)&&S(e)?(r=!0,d.error("网站图标获取失败")):200===e.code&&e.data&&(t=e.data.faviconUrl)}ee.setFieldsValue({label:s.title,icon:t,backgroundColor:me||"#ffffff",fontColor:he||"#000000",description:s.description,iconPadding:xe||6}),ee.validateFields({dirty:!0}),ie(ee.getFieldsValue()),r||d.success("获取网站信息完成"),T(1,Ce)}else y(1,Ce),N({url:G.getWebsiteInfo,data:{url:a}}).then(e=>{200===e?.code&&e.data&&(ee.setFieldValue("label",e.data.title||""),ee.setFieldValue("icon",e.data.icon||""),ee.setFieldValue("backgroundColor",e.data.backgroundColor||"#ffffff"),ee.setFieldValue("fontColor",e.data.fontColor||"#000000"),ee.setFieldValue("description",e.data.description||""),e.data.backgroundColor&&e.data.fontColor||ee.setFieldValue("iconPadding",6),ee.validateFields({dirty:!0}),setTimeout(()=>{ie(ee.getFieldsValue())},0))}).finally(()=>{T(1,Ce)})},loading:be[1],type:"text",className:"rounded-none",children:"获取信息",icon:p.jsx(w,{})})})}),p.jsx("div",{className:"flex items-center h-8 mb-6",children:p.jsx(P,{checked:le,checkedChildren:"内网",onChange:e=>{se(e)},unCheckedChildren:"常规"})})]}),p.jsx(j.Item,{label:"内网链接",required:!0,rules:[{required:le,message:"请输入内网链接"}],name:"internalLink",style:{display:le?"":"none"},children:p.jsx(b,{placeholder:"请输入内网链接，默认普通链接（http://）",allowClear:!0,maxLength:512})}),p.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[p.jsx(j.Item,{label:"卡片名称",name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:p.jsx(b,{placeholder:"请输入卡片名称",allowClear:!0,maxLength:100})}),"icon-h"===te||"icon-v"===te?p.jsx(j.Item,{label:"卡片内标题",name:"innerlabel",rules:[{validator:(e,a)=>a&&a.length>100?Promise.reject("卡片内标题不能超过20个字符"):Promise.resolve()}],children:p.jsx(b,{placeholder:"若填写，将替换卡片名称显示",allowClear:!0,maxLength:20})}):null]}),p.jsx(j.Item,{label:"卡片大小",name:"size",className:"*:max-w-64",required:!0,rules:[{required:!0,message:"请选择卡片大小"}],children:p.jsx(V,{placeholder:"请选择卡片大小",options:L})}),p.jsx(j.Item,{label:"展示样式",name:"showType",required:!0,rules:[{required:!0,message:"请选择展示样式"}],children:p.jsxs(q.Group,{className:"ml-3",children:[p.jsx(q,{value:"icon",children:"纯图"}),p.jsx(q,{value:"text",children:"文本"}),p.jsx(q,{value:"icon-h",children:"横版"}),p.jsx(q,{value:"icon-v",children:"竖版"})]})}),p.jsx(j.Item,{label:"图标地址",name:"icon",required:!0,style:{display:"text"!==te?"":"none"},rules:[{validator:(e,a)=>"text"===te||a&&""!==a?a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请获取或上传网站图标")}],children:p.jsx(b,{addonBefore:p.jsx(U,{title:"设为本地默认",destroyOnHidden:!0,children:p.jsx(C,{type:"text",className:"rounded-none",icon:p.jsx(W,{}),onClick:()=>{ee.setFieldValue("icon","/default/IeOutlined"),setTimeout(()=>{ie(ee.getFieldsValue())},0)}})}),placeholder:"请输入图标地址，默认安全链接（https://）",allowClear:!0,addonAfter:p.jsx(D,{disabled:!ne,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(d.error("图标大小不能超过200KB！"),!1):(y(0,Ce),N({url:G.uploadIcon,token:ne,data:B({file:e})}).then(e=>{if(200===e?.code&&e.data){ee.setFieldValue("icon",e.data.icon_url),ee.validateFields({dirty:!0});const a=ee.getFieldsValue();ie({...oe,...a,icon:e.data.icon_url})}}).finally(()=>{T(0,Ce)}),!1),children:p.jsx(C,{onClick:()=>{ne||d.error("请您先完成登录/注册")},loading:be[0],type:"text",className:"rounded-none",children:"上传",icon:p.jsx(z,{})})})})}),p.jsx(j.Item,{label:"文本内容",name:"text",style:{display:"text"!==te?"none":""},rules:[{validator:(e,a)=>a&&a.length>100?Promise.reject("文本内容不能超过20个字符"):Promise.resolve()}],children:p.jsx(b,{placeholder:"请输入文本内容",maxLength:20,allowClear:!0})}),p.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[p.jsx(j.Item,{label:"背景颜色",name:"backgroundColor",normalize:e=>e?.cleared?"":e.toHexString(),children:p.jsx(H,{showText:!0})}),p.jsx(j.Item,{label:"文字颜色",normalize:e=>e?.cleared?"":e.toHexString(),name:"fontColor",children:p.jsx(H,{showText:!0})})]}),p.jsx(O,{className:"mt-0 text-sm",children:"更多配置"}),p.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[p.jsx(j.Item,{label:"打开方式",name:"openTarget",required:!0,rules:[{required:!0,message:"请选择打开方式"}],children:p.jsx(V,{options:R,className:"max-w-32"})}),p.jsx(j.Item,{label:"图标内间距",name:"iconPadding",children:p.jsx(A,{min:0,max:48,precision:0,placeholder:"图标内间距"})})]}),p.jsx(j.Item,{className:"mb-16",label:"描述/备注",name:"description",rules:[{validator:(e,a)=>a&&a.length>255?Promise.reject("卡片描述/备注不能超过200个字符"):Promise.resolve()}],children:p.jsx(M,{autoSize:{minRows:2,maxRows:2},placeholder:"请输入卡片描述/备注",allowClear:!0,maxLength:200})}),p.jsxs("div",{className:"flex w-full justify-between flex-row-reverse gap-3 px-4 py-3 absolute left-0 bottom-0 z-10",style:{backgroundColor:ae.colorBgContainer,borderTop:`1px solid ${ae.colorBorderSecondary}`},children:[p.jsx(C,{onClick:()=>{$("save"),setTimeout(()=>{ee.submit()},0)},type:"primary",children:"导入书签"}),X||!X&&!Y?p.jsx(V,{options:pe,value:fe,placeholder:"目标分组",className:"w-32 max-w-full",onChange:e=>{const a=Q?.findIndex(a=>a.id===e),l=r.getState().stateUtils.mySwiper,s=r.getState().swiper.loop;-1!==a&&l&&(s?l.slideToLoop(a):l.slideTo(a))}}):null]})]})]})})}export{_ as default};
